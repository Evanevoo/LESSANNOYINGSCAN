(function(){"use strict";let s=0,t=[],d=100,r=[],a=!1,i=[];function l(o){const n=Math.min(o+d,t.length),e=t.slice(o,n);a&&console.log("Processing batch",o,n),self.postMessage({type:"batch",batchId:o,rows:e,start:o})}self.onmessage=function(o){const{type:n,data:e}=o.data;if(n==="start")t=e.rows,e.mapping,e.columns,e.allFields,d=e.batchSize||100,r=[],s=0,a=!!e.debug,i=[],l(s);else if(n==="resume")s=e.nextIndex,l(s);else if(n==="batchResult"){e.errors&&e.errors.length&&(r=r.concat(e.errors),e.errors.forEach(c=>{c.type==="line_item"&&c.error==="Not a cylinder"&&c.row&&i.push({invoiceDescription:c.row.description,cylinderDescription:"",invoiceProductCode:c.row.product_code,cylinderProductCode:"",reason:"No match"})})),s=e.nextIndex;const p=Math.round(s/t.length*100);self.postMessage({type:"progress",progress:p}),s<t.length?l(s):self.postMessage({type:"done",result:{processed:t.length,errors:r,skippedItems:i}})}}})();
